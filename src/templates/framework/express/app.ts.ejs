import path from "path";
import routers from "./router.js";
import cookieParser from "cookie-parser";
import { __dirname } from "./utils/path.js";
import express, { type Response } from "express";

// middlewares
import ErrorMiddleware from "./middlewares/error.middleware.js";

export const createExpressApp = () => {
    const app = express();

    // set view engine
    app.set("view engine", "ejs");
    app.set("views", "views");
    app.use(express.static(path.join(__dirname, "./public")));

    // middleware
    app.use(express.json());
    app.use(cookieParser());
    app.use(express.urlencoded({ extended: true }));

    // routes
    app.get("/", (_: any, res: Response) => res.send("Welcome to Express JS!"));
    app.use("/api/v1", Object.values(routers));

    // error middleware
    app.use(ErrorMiddleware);

    return app;
};